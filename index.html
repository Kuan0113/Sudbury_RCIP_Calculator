<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sudbury RCIP Scoring Calculator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; text-align: center; }
  h1 { color: #24292e; }
  h2 { margin-top: 2rem; color: #0366d6; }
  label { display: block; margin-top: 0.5rem; }
  select { width: 300px; padding: 0.5rem; margin-top: 0.3rem; text-align: left; }
  button, a.button {
    margin-top: 1.5rem;
    padding: 0.7rem 1.2rem;
    font-size: 1rem;
    background-color: #0366d6;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background 0.3s;
  }
  button:hover, a.button:hover { background-color: #024ea2; }
  #result { margin-top: 1.5rem; font-weight: bold; font-size: 1.2rem; }
  #details { display: none; margin-top: 1rem; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
</style>
</head>
<body>
<h1>Sudbury RCIP Scoring Calculator</h1>

<div id="calculator"></div>

<button onclick="calculatePoints()">Calculate Points</button>
<button onclick="calculatePoints();toggleDetails()">Show Details</button>
<a class="button" href="https://investsudbury.ca/why-sudbury/newcomers/rcipfcip/" target="_blank">RCIP Info</a>

<div id="result"></div>
<div id="details"></div>

<script>
// 分區類別與選項
const categories = {
  "Job Offer - Section": ["Natural and Applied Sciences", "Health", "Education, Social, Community and Government Services", "Trades and Transport", "Natural Resources and Agriculture"],
  "Job Offer - Occupation": [
    "12200 – Accounting Technicians and Bookkeepers",
    "13110 – Administrative Assistants",
    "21330 – Mining Engineers",
    "21301 – Mechanical Engineers",
    "21331 – Geological Engineers",
    "22300 – Civil Engineering Technologists and Technicians",
    "22301 – Mechanical Engineering Technologists and Technicians",
    "22310 – Electrical and Electronics Engineering Technologists and Technicians",
    "31202 – Physiotherapists",
    "31301 – Registered Nurses",
    "32101 – Registered Practical Nurses",
    "32109 – Rehabilitation Assistants",
    "33102 – Personal Care Attendants",
    "33100 – Dental Assistants",
    "42201 – Social and Community Service Workers",
    "42202 – Early Childhood Educators and Assistants",
    "44101 – Home Support Workers, Caregivers, and related occupations",
    "72401 – Heavy Duty Equipment Mechanics",
    "72410 – Automotive Service Technicians, Truck and Bus Mechanics, and Mechanical Repairers",
    "72106 – Welders and Related Machine Operators",
    "72400 – Construction Millwrights and Industrial Mechanics",
    "73400 – Heavy Equipment Operators",
    "75110 – Construction Trades Helpers and Labourers",
    "73300 – Truck Drivers",
    "95100 – Labourers in Metal Processing"
  ],
  "Human Capital - Work Experience": ["1 year full-time work experience", "2 years full-time work experience", "3 years full-time work experience", "4+ years full-time work experience", "International graduate exemption"],
  "Human Capital - Language Proficiency TEER": ["0/1", "2/3", "4/5"],
  "Human Capital - Education": ["Master's/PhD", "Bachelor's (3+ years)", "Post-secondary (1+ year)", "Canadian Secondary School Diploma"],
  "Human Capital - Intent to Reside": ["Submitted genuine statement", "Not submitted"]
};

// 對應分數
const pointsMapping = {
  "Job Offer - Section": [10,15,10,15,15],
  "Job Offer - Occupation": [
    0,0,10,10,10,10,10,10,10,10,8,0,0,0,5,7,0,10,10,10,10,10,5,2,2
  ],
  "Human Capital - Work Experience": [10,15,20,25,10],
  "Human Capital - Education": [25,20,15,10],
  "Human Capital - Intent to Reside": [10,0],
  "LanguageProficiency": {
    "0/1": {"CLB/NCLC 6":10,"CLB/NCLC 7":15,"CLB/NCLC 8":20,"CLB/NCLC 9+":25},
    "2/3": {"CLB/NCLC 5":10,"CLB/NCLC 6":15,"CLB/NCLC 7":20,"CLB/NCLC 8+":25},
    "4/5": {"CLB/NCLC 4":10,"CLB/NCLC 5":15,"CLB/NCLC 6":20,"CLB/NCLC 7+":25}
  },
  "Previous Work/Study in Community": [2,4,6],
  "Close Family in Community": [2],
  "Community Involvement": [2],
  "Property in Community": [2],
  "Spouse/Common-law Experience": [3]
};

const maxScores = {
  "Job Offer - Section": 15,
  "Job Offer - Occupation": 10,
  "Human Capital - Work Experience": 25,
  "LanguageProficiency": 25,
  "Human Capital - Education": 25,
  "Human Capital - Intent to Reside": 10,
  "Previous Work/Study in Community": 6,
  "Close Family in Community": 2,
  "Community Involvement": 2,
  "Property in Community": 2,
  "Spouse/Common-law Experience": 3
};

// 生成表單
const calculatorDiv = document.getElementById('calculator');
const selectedValues = {};

for (const category in categories) {
  const h2 = document.createElement('h2');
  h2.innerText = category;
  calculatorDiv.appendChild(h2);

  if(category === "Human Capital - Language Proficiency TEER") {
    const teerSelect = document.createElement('select');
    teerSelect.id = 'teerSelect';
    teerSelect.innerHTML = '<option value="">Select TEER</option>';
    categories[category].forEach(opt=>{
      const option = document.createElement('option');
      option.value = opt;
      option.innerText = opt;
      teerSelect.appendChild(option);
    });
    calculatorDiv.appendChild(teerSelect);

    const clbSelect = document.createElement('select');
    clbSelect.id = 'clbSelect';
    clbSelect.innerHTML = '<option value="">Select CLB/NCLC</option>';
    calculatorDiv.appendChild(clbSelect);

    teerSelect.addEventListener('change', ()=>{
      const selectedTEER = teerSelect.value;
      clbSelect.innerHTML = '<option value="">Select CLB/NCLC</option>';
      if(selectedTEER){
        for(const clb in pointsMapping.LanguageProficiency[selectedTEER]){
          const opt = document.createElement('option');
          opt.value = clb;
          opt.innerText = clb;
          clbSelect.appendChild(opt);
        }
      }
    });

    selectedValues['LanguageProficiency'] = {teer: teerSelect, clb: clbSelect};
  } else {
    const select = document.createElement('select');
    categories[category].forEach(option=>{
      const opt = document.createElement('option');
      opt.value = option;
      opt.innerText = option;
      select.appendChild(opt);
    });
    selectedValues[category] = select;
    calculatorDiv.appendChild(select);
  }
}

// Bonus Points
const h2Bonus = document.createElement('h2');
h2Bonus.innerText = 'Bonus Points';
calculatorDiv.appendChild(h2Bonus);

// Work/Study 下拉
const workStudyLabel = document.createElement('label');
workStudyLabel.innerText = "Candidate has previously worked and/or studied in the community.";
const previousSelect = document.createElement('select');
previousSelect.id = 'previousSelect';
["None","1 year (combined)","2 years (combined)","3 years or more (combined)"].forEach((opt,idx)=>{
  const option = document.createElement('option');
  option.value = opt;
  option.innerText = opt;
  previousSelect.appendChild(option);
});
calculatorDiv.appendChild(workStudyLabel);
calculatorDiv.appendChild(previousSelect);
selectedValues['Previous Work/Study in Community'] = previousSelect;

// 其他 Yes/No 下拉
function addYesNoSelect(labelText, key){
  const label = document.createElement('label');
  label.innerText = labelText;
  const select = document.createElement('select');
  ["No","Yes"].forEach(opt=>{
    const option = document.createElement('option');
    option.value = opt;
    option.innerText = opt;
    select.appendChild(option);
  });
  calculatorDiv.appendChild(label);
  calculatorDiv.appendChild(select);
  selectedValues[key] = select;
}

addYesNoSelect("You currently has a close family member (18 years or older) who is a permanent resident or Canadian citizen and who has been living in the community for a minimum of 12 months.", 'Close Family in Community');
addYesNoSelect("You has been volunteering with a community organization or part of a community group or sports team for at least 3 months.", 'Community Involvement');
addYesNoSelect("You are renting a property or owns a property in the community.", 'Property in Community');
addYesNoSelect("Your spouse/common law partner has work or study experience (6 month minimum) in the community.", 'Spouse/Common-law Experience');

// 計算邏輯
let sectionScores = {};
function calculatePoints(){
  let jobOfferTotal=0;
  let humanCapitalTotal=0;
  sectionScores={};

  for(const category in selectedValues){
    let score=0;
    if(['Close Family in Community','Community Involvement','Property in Community','Spouse/Common-law Experience'].includes(category)){
      const val = selectedValues[category].value;
      if(val==="Yes") score = pointsMapping[category][0];
      score=Math.min(score,maxScores[category]);
    } else if(category==='LanguageProficiency'){
      const teer=selectedValues[category].teer.value;
      const clb=selectedValues[category].clb.value;
      if(teer && clb) score=pointsMapping.LanguageProficiency[teer][clb];
      score=Math.min(score,maxScores['LanguageProficiency']);
    } else {
      const sel=selectedValues[category];
      const idx = sel.selectedIndex;
      if(category==='Previous Work/Study in Community'){
        score = idx===0 ? 0 : pointsMapping[category][idx-1];
      } else {
        score = Math.min(pointsMapping[category][idx], maxScores[category]);
      }
    }
    sectionScores[category]=score;
    if(category.startsWith('Job Offer')) jobOfferTotal+=score;
    else humanCapitalTotal+=score;
  }

  document.getElementById('result').innerHTML=`
    Total Points for Job Offer: ${Math.min(jobOfferTotal,25)} / 25<br>
    Human Capital Assessment: ${Math.min(humanCapitalTotal,100)} / 100<br>
    <strong>Total Points: ${Math.min(jobOfferTotal,25) + Math.min(humanCapitalTotal,100)} / 125</strong>
  `;
  document.getElementById('details').style.display='none';
}

function toggleDetails(){
  const detailsDiv = document.getElementById('details');
  if(detailsDiv.style.display==='none'){
    let text='';
    let bonusTotal = 0;

    for(const sec in sectionScores){
      if(['Previous Work/Study in Community','Close Family in Community','Community Involvement','Property in Community','Spouse/Common-law Experience'].includes(sec)){
        bonusTotal += sectionScores[sec];
      } else {
        text+=`${sec}: ${sectionScores[sec]} / ${maxScores[sec] || ''}<br>`;
      }
    }

    bonusTotal = Math.min(bonusTotal, 15);
    text += `Bonus Points: ${bonusTotal} / 15<br>`;

    detailsDiv.innerHTML=text;
    detailsDiv.style.display='block';
  } else {
    detailsDiv.style.display='none';
  }
}
</script>
</body>
</html>
